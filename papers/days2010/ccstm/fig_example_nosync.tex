\begin{figure}
\begin{lstlisting}{name=Code}
class Account(initialBalance: Money) {
  private var _balance = initialBalance

  def balance: Money = _balance

  def deposit(m: Money) {
    assert(m >= 0)
    _balance += m
  }

  def withdraw(m: Money) {
    assert(m >= 0)
    if (_balance < m)
      throw new OverdraftException
    _balance -= m
  }
}

object Account {
  def transfer(src: Account, dst: Account, m: Money) {
    src.withdraw(m)
    dst.deposit(m)
  }
}
\end{lstlisting}

\caption{Code that performs an account transfer without
any locking or other concurrency control.}

\label{fig:example:nosync}
\end{figure}
